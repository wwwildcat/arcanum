# arcanum
 
Установка: `npm install`

Запуск: `npm start /home/user/my-repos`, где `/home/user/my-repos` - путь до папки с репозиториями. В адресной строке браузера адрес вида http://localhost:3000/:repositoryID (название репозитория)

## Перевод проекта на TypeScript

Компиляция: `npm run compile`

Переводить проект на TypeScript в целом было несложно - и компоненты React, и функции бэкенда довольно однотипные, так что можно быстро научиться и делать по аналогии. Трудности возникли разве что с redux, redux-thunk и их типами, а также с библиотечными компонентами вроде <Router /> и их параметрами. Но если внимательно почитать их декларации, все становится понятно.
Ошибки нашлись на бэкенде - с `'use strict'` оказалось, что не все ошибки корректно обрабатываются, и многие из них роняют сервер.
В целом JavaScript привычнее, но TypeScript делает код более аккуратным и позволяет предотвратить некоторые глупые ошибки (например, моя любимая - потерять скобки у вызова метода без параметров). Так что PR я волью, чтобы постепенно привыкать и к TS.

## Блоки серверной части

Большинство запросов к серверу состоит из 3-х частей:

- подготовка параметров запроса

- собственно запрос через `child_process`

- форматирование ответа в нужный json

Поскольку собственно запрос возвращает результат работы стороннего API (git), то его нет смысла тестировать, а подготовку параметров и форматирование ответа для удобства тестирования можно выделить в отдельные функции. Например, для запроса содержимого директории [getRepository](https://github.com/wwwildcat/arcanum/blob/tests/src/server/callbacks/getRepository/getRepository.js) это [ветка getCommandParams](https://github.com/wwwildcat/arcanum/blob/tests/src/server/callbacks/getCommandParams.js#L11) и [getRepositoryData](https://github.com/wwwildcat/arcanum/blob/tests/src/server/callbacks/getRepository/getRepositoryData.js). Результатом их сценариев соответственно будет результат функции.

[Тесты](https://github.com/wwwildcat/arcanum/tree/tests/tests)

Запуск: `npm test` (и модульные, и интеграционные). Для корректной работы интеграционных тестов надо изменить `.hermione.conf.js`, прописав в поле meta:
```
meta: {
	repositoryID: *название репозитория*,
	pathToDir: *относительный путь к подпапке*,
	pathToFile: *относительный путь к файлу*
}
```